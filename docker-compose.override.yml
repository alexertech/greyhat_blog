# Development overrides for docker-compose.yml
# This file is automatically loaded when running docker-compose in development

services:
  database:
    ports:
      - "5433:5432"  # Expose database port for development tools
    environment:
      POSTGRES_DB: greyhat_development
      POSTGRES_USER: alex
      POSTGRES_PASSWORD: development_password

  redis:
    ports:
      - "6380:6379"  # Expose Redis port for development tools
    command: redis-server --appendonly yes  # No password in development

  web:
    build:
      target: builder  # Use builder stage with dev dependencies
    container_name: greyhat_web_dev
    environment:
      RAILS_ENV: development
      DATABASE_URL: postgresql://alex:development_password@database:5432/greyhat_development
      REDIS_URL: redis://redis:6379/0
      RAILS_SERVE_STATIC_FILES: "false"
      RAILS_LOG_TO_STDOUT: "true"
    volumes:
      - .:/app  # Mount source code for live reloading
      - bundle_cache:/usr/local/bundle  # Cache gems between runs
      - node_modules:/app/node_modules  # Cache npm packages
    ports:
      - "3000:3000"  # Standard Rails port
    networks:
      - greyhat_internal
      - default  # Add default network for external access
    command: ["bundle", "exec", "rails", "server", "-b", "0.0.0.0"]
    depends_on:
      database:
        condition: service_started  # Don't wait for healthy in development
      redis:
        condition: service_started

volumes:
  bundle_cache:
  node_modules: