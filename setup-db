#!/bin/bash

# Database setup script for alexertech.com
# Runs migrations and seeds on the remote Docker server

set -e

# Configuration
DOCKER_SERVER="192.168.0.50"
DOCKER_USER="alex"
APP_NAME="greyhat_cl"
DEPLOY_DIR="/home/alex/docker/docker_deploy/$APP_NAME"

echo "üóÑÔ∏è  Setting up database on $DOCKER_SERVER..."

# Run database setup on remote server
ssh $DOCKER_USER@$DOCKER_SERVER << EOF
  cd $DEPLOY_DIR

  echo "üîÑ Running database migrations..."
  docker compose exec web bundle exec rails db:create db:migrate

  echo "üå± Running database seeds..."
  docker compose exec web bundle exec rails db:seed

  echo "‚úÖ Database setup complete!"
EOF

echo "üéâ Database setup finished!"
